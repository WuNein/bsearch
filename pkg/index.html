<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>hello-wasm example</title>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <!-- <script src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lunr-languages@1.8.0/lunr.stemmer.support.js"></script>
  <script src="./lunr.zh 2.js"></script> -->
</head>

<body>
  <div style="padding: 50px;">
  <div class="input-group mb-3">
    <span class="input-group-text" id="basic-addon1">è¾“å…¥åˆ†è¯</span>
    <input type="text" id="WillSplit" class="form-control" placeholder="å¥å­" aria-label="Username"
      aria-describedby="basic-addon1">
  </div>
  <p id="showSplit"></p>
  <div class="input-group mb-3">
    <span class="input-group-text" id="basic-addon1">è¾“å…¥åˆ†è¯â€”â€”è¯æ€§</span>
    <input type="text" id="WillSplit2" class="form-control" placeholder="å¥å­" aria-label="Username"
      aria-describedby="basic-addon1">
  </div>
  <p id="showSplit2"></p>
  <div class="card">
    <div class="card-header">
      æœç´¢ğŸ”
    </div>
    <div class="card-body">
      <h5 class="card-title">æ·»åŠ æ–‡æ¡£</h5>
      
      <div class="input-group mb-3">
        <span class="input-group-text" id="basic-addon1">title</span>
        <input type="text" id="ctitle" class="form-control" placeholder="æ ‡é¢˜" aria-label="Username"
          aria-describedby="basic-addon1">
      </div>
      <div class="input-group mb-3">
        <span class="input-group-text" id="basic-addon1">context</span>
        <input type="text" id="ctext" class="form-control" placeholder="æ­£æ–‡" aria-label="Username"
          aria-describedby="basic-addon1">
      </div>
      <div class="input-group mb-3">
        <span class="input-group-text" id="basic-addon1">category</span>
        <input type="text" id="ccategory" class="form-control" placeholder="ç±»åˆ«" aria-label="Username"
          aria-describedby="basic-addon1">
      </div>
      <button id="AddDoc" class="btn btn-primary">æ·»åŠ </button>
      <p id="showDocumentCount"></p>

    </div>
    <div class="card-body">
      <h5 class="card-title">æœç´¢æ–‡æ¡£</h5>
      <div class="input-group mb-3">
        <span class="input-group-text" id="basic-addon1">å…³é”®è¯</span>
        <input type="text" id="cword" class="form-control" placeholder="å…³é”®è¯" aria-label="Username"
          aria-describedby="basic-addon1">
      </div>
      <button id="SearchButton" class="btn btn-primary">æœç´¢</button>
      <p id="showSearch"></p>
    </div>
  </div>
  </div>
  <!-- <script src="https://requirejs.org/docs/release/2.3.6/minified/require.js"></script> -->
  <script src="https://cdn.jsdelivr.net/npm/minisearch@3.0.2/dist/umd/index.min.js"></script>

  <script type="module">
    import init, { cut, cut_for_tag } from './rustJieba.js';
    // import {require} from './require.js';


    // console.log(init)
    async function main() {
      console.time("answer time");
      await init()
      console.timeLog("answer time");
      let res = cut("äºŒæ¬¡å…ƒçš„æŠ¥è¡¨")
      console.log(JSON.parse(res))
      console.timeLog("answer time");
      res = cut("æŠ¥è¡¨ä¿¡æ¯")
      console.log(JSON.parse(res))
      console.timeLog("answer time");
      res = cut_for_tag("æ¯”è¾ƒå¤šçš„ä¿¡æ¯")
      console.log(JSON.parse(res))
      console.timeLog("answer time");
    }
    let stopWords = new Set(["çš„", "ä¸€", "ä¸", "åœ¨", "äºº", "æœ‰", "æ˜¯", "ä¸º", "ä»¥", "äº", "ä¸Š", "ä»–", "è€Œ", "å", "ä¹‹", "æ¥", "åŠ", "äº†", "å› ", "ä¸‹", "å¯", "åˆ°", "ç”±", "è¿™", "ä¸", "ä¹Ÿ", "æ­¤", "ä½†", "å¹¶", "ä¸ª", "å…¶", "å·²", "æ— ", "å°", "æˆ‘", "ä»¬", "èµ·", "æœ€", "å†", "ä»Š", "å»", "å¥½", "åª", "åˆ", "æˆ–", "å¾ˆ", "äº¦", "æŸ", "æŠŠ", "é‚£", "ä½ ", "ä¹ƒ", "å®ƒ", "å§", "è¢«", "æ¯”", "åˆ«", "è¶", "å½“", "ä»", "åˆ°", "å¾—", "æ‰“", "å‡¡", "å„¿", "å°”", "è¯¥", "å„", "ç»™", "è·Ÿ", "å’Œ", "ä½•", "è¿˜", "å³", "å‡ ", "æ—¢", "çœ‹", "æ®", "è·", "é ", "å•¦", "äº†", "å¦", "ä¹ˆ", "æ¯", "ä»¬", "å˜›", "æ‹¿", "å“ª", "é‚£", "æ‚¨", "å‡­", "ä¸”", "å´", "è®©", "ä»", "å•¥", "å¦‚", "è‹¥", "ä½¿", "è°", "è™½", "éš", "åŒ", "æ‰€", "å¥¹", "å“‡", "å—¡", "å¾€", "å“ª", "äº›", "å‘", "æ²¿", "å“Ÿ", "ç”¨", "äº", "å’±", "åˆ™", "æ€", "æ›¾", "è‡³", "è‡´", "ç€", "è¯¸", "è‡ª"])
    const documents = [
      {
        id: 1,
        title: 'äºŒæ¬¡å…ƒçš„æŠ¥è¡¨',
        text: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ç”¨çš„æ•°æ®æŠ¥è¡¨',
        category: 'æµ‹è¯•'
      },
      {
        id: 2,
        title: 'æ•°æ®åº“æ˜¯éå¸¸å¤æ‚çš„',
        text: 'è®©æˆ‘è¯•ä¸€ä¸‹è¿™ä¸ªæ•°æ®åº“',
        category: 'æµ‹è¯•'
      }
    ]
    var miniSearch 
    main().then(() => {
      miniSearch = new MiniSearch({
        tokenize: (string) => {
          // console.log(string.split(' '))
          // console.log(cut(string))
          return JSON.parse(cut(string))
        },
        fields: ['title', 'text'], // fields to index for full-text search
        storeFields: ['title', 'category'], // fields to return with search results
        // processTerm: (term, _fieldName) =>
        //   stopWords.has(term) ? null : term,
      })
      miniSearch.addAll(documents)
      let resu = miniSearch.search('æˆ‘çš„æŠ¥è¡¨', { fields: ['title'] })
      console.log(resu)
      $("#showSearch").text(JSON.stringify(resu))
      
    })

    $('#WillSplit').change((e) => {
      console.log($('#WillSplit').val())
      let res = cut($('#WillSplit').val())
      console.log(JSON.parse(res))
      $("#showSplit").text(res)
    }
    )
    $('#WillSplit2').change((e) => {
      console.log($('#WillSplit2').val())
      let res = cut_for_tag($('#WillSplit2').val())
      console.log(JSON.parse(res))
      $("#showSplit2").text(res)
    }
    )
    var seq = 3
    $("#AddDoc").click(function(){
      miniSearch.add({
        id: seq++,
        title: $('#ctitle').val(),
        text: $('#ctext').val(),
        category: $('#ccategory').val()
      })
      
    });
    $("#SearchButton").click(function(){
      let resq = miniSearch.search($('#cword').val(), { fields: ['title','text'] })
      $("#showSearch").text(JSON.stringify(resq))

    });


  </script>
</body>

</html>